include:
  - component: gitlab.com/components/opentofu/validate-plan-apply@2.0.0-rc1
    inputs:
      version: 2.0.0-rc1
      opentofu_version: 1.9.0
      root_dir: opentofu/
      state_name: production

stages:
  - validate
  - build
  - plan
  - apply
  - deploy

deploy_web:
  stage: deploy
  image: node:23.10.0
  only:
    - main
  needs:
    - job: apply
  script:
    - npm install --global vercel
    - vercel pull --yes --environment=production --token=$TF_VAR_vercel_token
    - vercel build --prod --token=$TF_VAR_vercel_token
    - vercel deploy --prebuilt --prod --token=$TF_VAR_vercel_token